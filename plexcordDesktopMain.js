// Plexcord 2aadd4d
// Standalone: true
// Platform: Universal
// Updater Disabled: false
"use strict";var sn=Object.create;var Oe=Object.defineProperty;var an=Object.getOwnPropertyDescriptor;var ln=Object.getOwnPropertyNames;var cn=Object.getPrototypeOf,un=Object.prototype.hasOwnProperty;var Y=(e,t)=>()=>(e&&(t=e(e=0)),t);var ee=(e,t)=>{for(var r in t)Oe(e,r,{get:t[r],enumerable:!0})},Mt=(e,t,r,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of ln(t))!un.call(e,n)&&n!==r&&Oe(e,n,{get:()=>t[n],enumerable:!(i=an(t,n))||i.enumerable});return e};var Me=(e,t,r)=>(r=e!=null?sn(cn(e)):{},Mt(t||!e||!e.__esModule?Oe(r,"default",{value:e,enumerable:!0}):r,e)),fn=e=>Mt(Oe({},"__esModule",{value:!0}),e);var l=Y(()=>{"use strict"});function ue(e,t={}){return new Promise((r,i)=>{Ct.default.get(e,t,n=>{let{statusCode:s,statusMessage:o,headers:a}=n;if(s>=400)return void i(`${s}: ${o} - ${e}`);if(s>=300)return void r(ue(a.location,t));let c=[];n.on("error",i),n.on("data",h=>c.push(h)),n.once("end",()=>r(Buffer.concat(c)))})})}var Ct,Ye=Y(()=>{"use strict";l();Ct=Me(require("https"))});var Te=Y(()=>{"use strict";l()});var Ee,Je=Y(()=>{l();Ee="2aadd4d"});var fe,Ke=Y(()=>{l();fe="MutanPlex/Plexcord"});var zt,Lt=Y(()=>{"use strict";l();Je();Ke();zt=`Plexcord/${Ee}${fe?` (https://github.com/${fe})`:""}`});function be(e){return async function(){try{return{ok:!0,value:await e(...arguments)}}catch(t){return{ok:!1,error:t instanceof Error?{...t}:t}}}}var Gt,Ut=Y(()=>{"use strict";l();Gt=["plexcordDesktopMain.js","plexcordDesktopPreload.js","plexcordDesktopRenderer.js","plexcordDesktopRenderer.css"]});var mn={};async function Wt(e){return ue(hn+e,{headers:{Accept:"application/vnd.github+json","User-Agent":zt}})}async function pn(){if(!await jt())return[];let t=await Wt(`/compare/${Ee}...HEAD`);return JSON.parse(t.toString("utf-8")).commits.map(i=>({hash:i.sha.slice(0,7),author:i.author.login,message:i.commit.message.split(`
`)[0]}))}async function jt(){let e=await Wt("/releases/latest"),t=JSON.parse(e.toString());return t.name.slice(t.name.lastIndexOf(" ")+1)===Ee?!1:(t.assets.forEach(({name:i,browser_download_url:n})=>{Gt.some(s=>i.startsWith(s))&&qe.push([i,n])}),!0)}async function dn(){return await Promise.all(qe.map(async([e,t])=>(0,Nt.writeFile)((0,Zt.join)(__dirname,e),await ue(t)))),qe=[],!0}var Pe,Nt,Zt,hn,qe,Ft=Y(()=>{"use strict";l();Ye();Te();Lt();Pe=require("electron"),Nt=require("fs/promises"),Zt=require("path");Je();Ke();Ut();hn=`https://api.github.com/repos/${fe}`,qe=[];Pe.ipcMain.handle("PlexcordGetRepo",be(()=>`https://github.com/${fe}`));Pe.ipcMain.handle("PlexcordGetUpdates",be(pn));Pe.ipcMain.handle("PlexcordUpdate",be(jt));Pe.ipcMain.handle("PlexcordBuild",be(dn))});l();var se=require("electron"),Qr=require("path");l();l();Ft();l();Te();var vt=require("electron");l();var nt={};ee(nt,{fetchTrackData:()=>bn});l();l();l();l();var y=11400714785074694791n,P=14029467366897019727n,$t=1609587929392839161n,Ie=9650029242287828579n,Ht=2870177450012600261n,Vt=64n,vn=2n**Vt-1n,gn=new TextEncoder;function Bt(e,t,r,i){return BigInt(e)|BigInt(t)<<16n|BigInt(r)<<32n|BigInt(i)<<48n}function $(e,t){return BigInt(e[t])|BigInt(e[t+1])<<8n|BigInt(e[t+2])<<16n|BigInt(e[t+3])<<24n|BigInt(e[t+4])<<32n|BigInt(e[t+5])<<40n|BigInt(e[t+6])<<48n|BigInt(e[t+7])<<56n}function x(e,t){return e<<t&vn|e>>Vt-t}function f(e){return BigInt.asUintN(64,e)}var et=class{#t;#r;#n;#i;#o;#s;#a;#e;constructor(t=0){this.reset(t)}reset(t=this.#t){return this.#t=BigInt.asUintN(32,BigInt(t)),this.#r=f(this.#t+y+P),this.#n=f(this.#t+P),this.#i=this.#t,this.#o=f(this.#t-y),this.#s=null,this.#a=0,this.#e=0,this}update(t){typeof t=="string"&&(t=gn.encode(t));let r=0,i=t.length,n=r+i;if(i===0)return this;if(this.#a+=i,this.#e===0&&(this.#s=new Uint8Array(32)),this.#e+i<32)return this.#s.set(t.subarray(0,i),this.#e),this.#e+=i,this;if(this.#e>0){this.#s.set(t.subarray(0,32-this.#e),this.#e);let s=0,o;o=$(this.#s,s),this.#r=f(x(f(this.#r+o*P),31n)*y),s+=8,o=$(this.memory,s),this.#n=f(x(f(this.#n+o*P),31n)*y),s+=8,o=$(this.memory,s),this.#i=f(x(f(this.#i+o*P),31n)*y),s+=8,o=$(this.memory,s),this.#o=f(x(f(this.#o+o*P),31n)*y),r+=32-this.#e,this.#e=0}if(r<=n-32){let s=n-32;do{let o;o=$(t,r),this.#r=f(x(f(this.#r+o*P),31n)*y),r+=8,o=$(t,r),this.#n=f(x(f(this.#n+o*P),31n)*y),r+=8,o=$(t,r),this.#i=f(x(f(this.#i+o*P),31n)*y),r+=8,o=$(t,r),this.#o=f(x(f(this.#o+o*P),31n)*y),r+=8}while(r<=s)}return r<n&&(this.#s.set(t.subarray(r,n),this.#e),this.#e=n-r),this}digest(){let t=this.#s,r=this.#e,i=0,n=0n,s=0n,o=0n;for(this.#a>=32?(n=x(this.#r,1n)+x(this.#n,7n)+x(this.#i,12n)+x(this.#o,18n),n=f(n^x(f(this.#r*P),31n)*y),n=f(n*y+Ie),n=f(n^x(f(this.#n*P),31n)*y),n=f(n*y+Ie),n=f(n^x(f(this.#i*P),31n)*y),n=f(n*y+Ie),n=f(n^x(f(this.#o*P),31n)*y),n=f(n*y+Ie)):n=f(this.#t+Ht),n+=BigInt(this.#a);i<=r-8;)o=$(t,i),o=f(x(f(o*P),31n)*y),n=f(x(n^o,27n)*y+Ie),i+=8;for(i+4<=r&&(o=Bt(t[i+1]<<8|t[i],t[i+3]<<8|t[i+2],0,0),n=f(x(n^f(o*y),23n)*P+$t),i+=4);i<r;)o=Bt(t[i++],0,0,0),n=f(x(n^f(o*Ht),11n)*y);return s=f(n>>33n),n=f((n^s)*P),s=f(n>>29n),n=f((n^s)*$t),s=f(n>>32n),n=f(n^s),n}};function Xt(e,t=0){return new et(t).update(e).digest()}var he="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),yn=(()=>{let e=new Uint8Array(4),t=new Uint32Array(e.buffer);return!((t[0]=1)&e[0])})();function wn(e){e=BigInt(e);let t=[],r=Math.ceil(Math.floor(Math.log2(Number(e))+1)/8);for(let n=0;n<r;n++)t.unshift(Number(e>>BigInt(8*n)&BigInt(255)));let i=new Uint8Array(t);return yn?i:i.reverse()}function Yt(e){let t=Xt(e,0),r=wn(t);return[he[r[0]>>2],he[(r[0]&3)<<4|r[1]>>4],he[(r[1]&15)<<2|r[2]>>6],he[r[2]&63],he[r[3]>>2],he[(r[3]&3)<<4|r[3]>>4]].join("")}function Jt(e){let t=typeof e=="string"?e:e.source;if(t=t.replaceAll(/#{intl::([\w$+/]*)(?:::(\w+))?}/g,(n,s,o)=>{let a=o==="raw"?s:Yt(s),c=typeof e=="string";return!Number.isNaN(Number(a[0]))||a.includes("+")||a.includes("/")?c?`["${a}"]`:String.raw`(?:\["${a}"\])`.replaceAll("+","\\+"):c?`.${a}`:String.raw`(?:\.${a})`}),typeof e=="string")return t;let r=t.replaceAll("\\i",String.raw`(?:[A-Za-z_$][\w$]*)`),i=new RegExp(r,e.flags);return i.toString=e.toString.bind(e),i}var Kt=require("child_process"),qt=require("util"),Qt=(0,qt.promisify)(Kt.execFile);async function tt(e){let{stdout:t}=await Qt("osascript",e.map(r=>["-e",r]).flat());return t}var U=null,xn=/<script type="module" crossorigin src="([a-zA-Z0-9.\-/]+)"><\/script>/,Sn=Jt(/Promise.allSettled\(\i\)\}const \i="([A-Za-z0-9-_]*\.[A-Za-z0-9-_]*\.[A-Za-z0-9-_]*)"/),rt,Tn=async()=>{if(rt)return rt;let e=await fetch("https://music.apple.com/").then(n=>n.text()),t=new URL(e.match(xn)[1],"https://music.apple.com/"),i=(await fetch(t).then(n=>n.text())).match(Sn)[1];return rt=i,i};async function En({id:e,name:t,artist:r,album:i}){if(e===U?.id){if("data"in U)return U.data;if("failures"in U&&U.failures>=5)return null}try{let n=new URL("https://amp-api-edge.music.apple.com/v1/catalog/us/search");n.searchParams.set("platform","web"),n.searchParams.set("l","en-US"),n.searchParams.set("limit","1"),n.searchParams.set("with","serverBubbles"),n.searchParams.set("types","songs"),n.searchParams.set("term",`${t} ${r} ${i}`),n.searchParams.set("include[songs]","artists");let s=await Tn(),o=await fetch(n,{headers:{accept:"*/*","accept-language":"en-US,en;q=0.9",authorization:`Bearer ${s}`,"user-agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36",origin:"https://music.apple.com"}}).then(a=>a.json()).then(a=>a.results.song.data[0]);return U={id:e,data:{appleMusicLink:o.attributes.url,songLink:`https://song.link/i/${o.id}`,albumArtwork:o.attributes.artwork.url.replace("{w}x{h}","512x512"),artistArtwork:o.relationships.artists.data[0].attributes.artwork.url.replace("{w}x{h}","512x512")}},U.data}catch(n){return console.error("[AppleMusicRichPresence] Failed to fetch remote data:",n),U={id:e,failures:(e===U?.id&&"failures"in U?U.failures:0)+1},null}}async function bn(){try{await Qt("pgrep",["^Music$"])}catch{return null}if(await tt(['tell application "Music"',"get player state","end tell"]).then(p=>p.trim())!=="playing")return null;let t=await tt(['tell application "Music"',"get player position","end tell"]).then(p=>Number.parseFloat(p.trim())),r=await tt(['set output to ""','tell application "Music"',"set t_id to database id of current track","set t_name to name of current track","set t_album to album of current track","set t_artist to artist of current track","set t_duration to duration of current track",'set output to "" & t_id & "\\n" & t_name & "\\n" & t_album & "\\n" & t_artist & "\\n" & t_duration',"end tell","return output"]),[i,n,s,o,a]=r.split(`
`).filter(p=>!!p),c=Number.parseFloat(a),h=await En({id:i,name:n,artist:o,album:s});return{name:n,album:s,artist:o,playerPosition:t,duration:c,...h}}var it={};ee(it,{initDevtoolsOpenEagerLoad:()=>Pn});l();function Pn(e){let t=()=>e.sender.executeJavaScript("Plexcord.Plugins.plugins.ConsoleShortcuts.eagerLoad(true)");e.sender.isDevToolsOpened()?t():e.sender.once("devtools-opened",()=>t())}var ar={};l();l();Te();l();var ot=Symbol("SettingsStore.isProxy"),er=Symbol("SettingsStore.getRawTarget"),De=class{pathListeners=new Map;globalListeners=new Set;proxyContexts=new WeakMap;proxyHandler=(()=>{let t=this;return{get(r,i,n){if(i===ot)return!0;if(i===er)return r;let s=Reflect.get(r,i,n),o=t.proxyContexts.get(r);if(o==null)return s;let{root:a,path:c}=o;if(!(i in r)&&t.getDefaultValue!=null&&(s=t.getDefaultValue({target:r,key:i,root:a,path:c})),typeof s=="object"&&s!==null&&!s[ot]){let h=`${c}${c&&"."}${i}`;return t.makeProxy(s,a,h)}return s},set(r,i,n){if(n?.[ot]&&(n=n[er]),r[i]===n)return!0;if(!Reflect.set(r,i,n))return!1;let s=t.proxyContexts.get(r);if(s==null)return!0;let{root:o,path:a}=s,c=`${a}${a&&"."}${i}`;return t.notifyListeners(c,n,o),!0},deleteProperty(r,i){if(!Reflect.deleteProperty(r,i))return!1;let n=t.proxyContexts.get(r);if(n==null)return!0;let{root:s,path:o}=n,a=`${o}${o&&"."}${i}`;return t.notifyListeners(a,void 0,s),!0}}})();constructor(t,r={}){this.plain=t,this.store=this.makeProxy(t),Object.assign(this,r)}makeProxy(t,r=t,i=""){return this.proxyContexts.set(t,{root:r,path:i}),new Proxy(t,this.proxyHandler)}notifyListeners(t,r,i){let n=t.split(".");if(n.length>2&&n[0]==="plugins"){let s=n.slice(0,3),o=s.join("."),a=s.reduce((c,h)=>c[h],i);this.globalListeners.forEach(c=>c(i,o)),this.pathListeners.get(o)?.forEach(c=>c(a))}else this.globalListeners.forEach(s=>s(i,t));this.pathListeners.get(t)?.forEach(s=>s(r))}setData(t,r){if(this.readOnly)throw new Error("SettingsStore is read-only");if(this.plain=t,this.store=this.makeProxy(t),r){let i=t,n=r.split(".");for(let s of n){if(!i){console.warn(`Settings#setData: Path ${r} does not exist in new data. Not dispatching update`);return}i=i[s]}this.pathListeners.get(r)?.forEach(s=>s(i))}this.markAsChanged()}addGlobalChangeListener(t){this.globalListeners.add(t)}addChangeListener(t,r){let i=this.pathListeners.get(t)??new Set;i.add(r),this.pathListeners.set(t,i)}removeGlobalChangeListener(t){this.globalListeners.delete(t)}removeChangeListener(t,r){let i=this.pathListeners.get(t);i&&(i.delete(r),i.size||this.pathListeners.delete(t))}markAsChanged(){this.globalListeners.forEach(t=>t(this.plain,""))}};l();function st(e,t){for(let r in t){let i=t[r];typeof i=="object"&&!Array.isArray(i)?(e[r]??={},st(e[r],i)):e[r]??=i}return e}var Le=require("electron"),re=require("fs");l();var tr=require("electron"),J=require("path"),Ce=process.env.PLEXCORD_USER_DATA_DIR??(process.env.DISCORD_USER_DATA_DIR?(0,J.join)(process.env.DISCORD_USER_DATA_DIR,"..","PlexcordData"):(0,J.join)(tr.app.getPath("userData"),"..","Plexcord")),pe=(0,J.join)(Ce,"settings"),te=(0,J.join)(Ce,"themes"),ze=(0,J.join)(pe,"quickCss.css"),at=(0,J.join)(pe,"settings.json"),lt=(0,J.join)(pe,"native-settings.json"),rr=["https:","http:","steam:","spotify:","com.epicgames.launcher:","tidal:","itunes:"];(0,re.mkdirSync)(pe,{recursive:!0});function ir(e,t){try{return JSON.parse((0,re.readFileSync)(t,"utf-8"))}catch(r){return r?.code!=="ENOENT"&&console.error(`Failed to read ${e} settings`,r),{}}}var C=new De(ir("renderer",at));C.addGlobalChangeListener(()=>{try{(0,re.writeFileSync)(at,JSON.stringify(C.plain,null,4))}catch(e){console.error("Failed to write renderer settings",e)}});Le.ipcMain.handle("PlexcordGetSettingsDir",()=>pe);Le.ipcMain.on("PlexcordGetSettings",e=>e.returnValue=C.plain);Le.ipcMain.handle("PlexcordSetSettings",(e,t,r)=>{C.setData(t,r)});var In={plugins:{}},or=ir("native",lt);st(or,In);var nr=new De(or);nr.addGlobalChangeListener(()=>{try{(0,re.writeFileSync)(lt,JSON.stringify(nr.plain,null,4))}catch(e){console.error("Failed to write native settings",e)}});var sr=require("electron");sr.app.on("browser-window-created",(e,t)=>{t.webContents.on("frame-created",(r,{frame:i})=>{i?.once("dom-ready",()=>{if(i.url.startsWith("https://open.spotify.com/embed/")){let n=C.store.plugins?.FixSpotifyEmbeds;if(!n?.enabled)return;i.executeJavaScript(`
                    const original = Audio.prototype.play;
                    Audio.prototype.play = function() {
                        this.volume = ${n.volume/100||.1};
                        return original.apply(this, arguments);
                    }
                `)}})})});var cr={};l();var lr=require("electron");lr.app.on("browser-window-created",(e,t)=>{t.webContents.on("frame-created",(r,{frame:i})=>{i?.once("dom-ready",()=>{if(i.url.startsWith("https://www.youtube.com/")){if(!C.store.plugins?.FixYoutubeEmbeds?.enabled)return;i.executeJavaScript(`
                new MutationObserver(() => {
                    if(
                        document.querySelector('div.ytp-error-content-wrap-subreason a[href*="www.youtube.com/watch?v="]')
                    ) location.reload()
                }).observe(document.body, { childList: true, subtree:true });
                `)}})})});var ft={};ee(ft,{checkffmpeg:()=>Ln,checkytdlp:()=>Gn,execute:()=>zn,getStdout:()=>Nn,interrupt:()=>Un,isFfmpegAvailable:()=>Wn,isYtdlpAvailable:()=>Zn,start:()=>An,stop:()=>Rn});l();var q=require("child_process"),I=Me(require("fs")),ur=Me(require("os")),ut=Me(require("path")),H=null,K="",Ge="",ct=!1,ie=!1,de=null,me=null,Ne=()=>H??process.cwd(),ne=e=>ut.default.join(Ne(),e),fr=()=>{H&&I.readdirSync(H).filter(e=>e.startsWith("download.")||e.startsWith("remux.")).forEach(e=>I.unlinkSync(ne(e)))},Ue=e=>(K+=e,K=K.replace(/^.*\r([^\n])/gm,"$1")),B=(...e)=>(console.log(`[Plugin:MediaDownloader] ${e.join(" ")}`),Ge+=`[Plugin:MediaDownloader] ${e.join(" ")}
`),hr=(...e)=>console.error(`[Plugin:MediaDownloader] [ERROR] ${e.join(" ")}`);function pr(e){B(`Executing yt-dlp with args: ["${e.map(r=>r.replace('"','\\"')).join('", "')}"]`);let t="";return new Promise((r,i)=>{de=(0,q.spawn)("yt-dlp",e,{cwd:Ne()}),de.stdout.on("data",n=>Ue(n)),de.stderr.on("data",n=>{Ue(n),hr(`yt-dlp encountered an error: ${n}`),t+=n}),de.on("exit",n=>{de=null,n===0?r(K):i(new Error(t||`yt-dlp exited with code ${n}`))})})}function Dn(e){B(`Executing ffmpeg with args: ["${e.map(r=>r.replace('"','\\"')).join('", "')}"]`);let t="";return new Promise((r,i)=>{me=(0,q.spawn)("ffmpeg",e,{cwd:Ne()}),me.stdout.on("data",n=>Ue(n)),me.stderr.on("data",n=>{Ue(n),hr(`ffmpeg encountered an error: ${n}`),t+=n}),me.on("exit",n=>{me=null,n===0?r(K):i(new Error(t||`ffmpeg exited with code ${n}`))})})}async function An(e,t){return t||=I.mkdtempSync(ut.default.join(ur.default.tmpdir(),"plexcord_mediaDownloader_")),I.existsSync(t)||I.mkdirSync(t,{recursive:!0}),H=t,B("Using workdir: ",H),H}async function Rn(e){H&&(B("Cleaning up workdir"),I.rmSync(H,{recursive:!0}),H=null)}async function _n(e){K="";let t=JSON.parse(await pr(["-J",e.url,"--no-warnings"]));if(t.is_live)throw"Live streams are not supported.";return K="",{videoTitle:`${t.title||"video"} (${t.id})`}}function kn({videoTitle:e},{maxFileSize:t,format:r}){let i=!!t,n=i?t*.8:0,s=i?t*.2:0,o={noFfmpeg:"ba[ext=mp3]{TOT_SIZE}/wa[ext=mp3]{TOT_SIZE}",ffmpeg:"ba*{TOT_SIZE}/ba{TOT_SIZE}/wa*{TOT_SIZE}/ba*"},a={noFfmpeg:"b{TOT_SIZE}{HEIGHT}[ext=webm]/b{TOT_SIZE}{HEIGHT}[ext=mp4]/w{HEIGHT}{TOT_SIZE}",ffmpeg:"b*{VID_SIZE}{HEIGHT}+ba{AUD_SIZE}/b{TOT_SIZE}{HEIGHT}/b*{HEIGHT}+ba"},c={ffmpeg:"bv{TOT_SIZE}/wv{TOT_SIZE}"},h;switch(r){case"audio":h=o;break;case"gif":h=c;break;case"video":default:h=a;break}let p=(ie?h.ffmpeg:h.noFfmpeg)?.replaceAll("{TOT_SIZE}",i?`[filesize<${t}]`:"").replaceAll("{VID_SIZE}",i?`[filesize<${n}]`:"").replaceAll("{AUD_SIZE}",i?`[filesize<${s}]`:"").replaceAll("{HEIGHT}","[height<=1080]");if(!p)throw"Gif format is only supported with ffmpeg.";return B("Video formated calculated as ",p),B(`Based on: format=${r}, maxFileSize=${t}, ffmpegAvailable=${ie}`),{format:p,videoTitle:e}}async function On({format:e,videoTitle:t},{ytdlpArgs:r,url:i,format:n}){fr();let s=["-f",e,"-o","download.%(ext)s","--force-overwrites","-I","1"],o=ie?n==="video"?["--remux-video","webm>webm/mp4"]:n==="audio"?["--extract-audio","--audio-format","mp3"]:[]:[],a=r?.filter(Boolean)||[];await pr([i,...s,...o,...a]);let c=I.readdirSync(Ne()).find(h=>h.startsWith("download."));if(!c)throw"No video file was found!";return{file:c,videoTitle:t}}async function Mn({file:e,videoTitle:t},{ffmpegArgs:r,format:i,maxFileSize:n,gifQuality:s}){let o=e.split(".").pop();if(!ie)return B("Skipping remux, ffmpeg is unavailable."),{file:e,videoTitle:t,extension:o};let a=["mp3","mp4","webm"],c=I.statSync(ne(e)).size,h=r?.filter(Boolean)||[],p=a.includes(o??""),u=!n||c<=n,g=h.length>0;if(p&&u&&!g&&!(i==="gif"))return B("Skipping remux, file type and size are good, and no ffmpeg arguments were specified."),{file:e,videoTitle:t,extension:o};let F=parseFloat((0,q.execFileSync)("ffprobe",["-v","error","-show_entries","format=duration","-of","default=noprint_wrappers=1:nokey=1",ne(e)]).toString());if(isNaN(F))throw"Failed to get video duration.";let w=~~((n?n*7/F:9999999)/1024),T,A;switch(i){case"audio":T=["-i",ne(e),"-b:a",`${w}k`,"-maxrate",`${w}k`,"-bufsize","1M","-y"],A="mp3";break;case"video":default:let E=w<=100?480:w<=500?720:1080;T=["-i",ne(e),"-b:v",`${~~(w*.8)}k`,"-b:a",`${~~(w*.2)}k`,"-maxrate",`${w}k`,"-bufsize","1M","-y","-filter:v",`scale=-1:${E}`],A="mp4";break;case"gif":let D,k,O,G;switch(s){case 1:D=5,k=360,O=24,G=5;break;case 2:D=10,k=420,O=32,G=5;break;default:case 3:D=15,k=480,O=64,G=4;break;case 4:D=20,k=540,O=64,G=3;break;case 5:D=30,k=720,O=128,G=1;break}T=["-i",ne(e),"-vf",`fps=${D},scale=w=${k}:h=-1:flags=lanczos,mpdecimate,split[s0][s1];[s0]palettegen=max_colors=${O}[p];[s1][p]paletteuse=dither=bayer:bayer_scale=${G}`,"-loop","0","-bufsize","1M","-y"],A="gif";break}return await Dn([...T,...h,`remux.${A}`]),{file:`remux.${A}`,videoTitle:t,extension:A}}function Cn({file:e,videoTitle:t,extension:r}){if(!r)throw"Invalid extension.";return{buffer:I.readFileSync(ne(e)),title:`${t}.${r}`}}async function zn(e,t){Ge="";try{let r=await _n(t),i=kn(r,t),n=await On(i,t),s=await Mn(n,t),o=Cn(s);return{logs:Ge,...o}}catch(r){return{error:r.toString(),logs:Ge}}}function Ln(e){try{return(0,q.execFileSync)("ffmpeg",["-version"]),(0,q.execFileSync)("ffprobe",["-version"]),ie=!0,!0}catch{return ie=!1,!1}}async function Gn(e){try{return(0,q.execFileSync)("yt-dlp",["--version"]),ct=!0,!0}catch{return ct=!1,!1}}async function Un(e){B("Interrupting..."),de?.kill(),me?.kill(),fr()}var Nn=()=>K,Zn=()=>ct,Wn=()=>ie;var ht={};ee(ht,{resolveRedirect:()=>Fn});l();var dr=require("https"),jn=/^https:\/\/(spotify\.link|s\.team)\/.+$/;function mr(e){return new Promise((t,r)=>{let i=(0,dr.request)(new URL(e),{method:"HEAD"},n=>{t(n.headers.location?mr(n.headers.location):e)});i.on("error",r),i.end()})}async function Fn(e,t){return jn.test(t)?mr(t):t}var pt={};ee(pt,{makeDeeplTranslateRequest:()=>$n});l();async function $n(e,t,r,i){let n=t?"https://api.deepl.com/v2/translate":"https://api-free.deepl.com/v2/translate";try{let s=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`DeepL-Auth-Key ${r}`},body:i}),o=await s.text();return{status:s.status,data:o}}catch(s){return{status:-1,data:String(s)}}}var dt={};ee(dt,{readRecording:()=>Hn});l();var vr=require("electron"),gr=require("fs/promises"),Ae=require("path");async function Hn(e,t){t=(0,Ae.normalize)(t);let r=(0,Ae.basename)(t),i=(0,Ae.normalize)(vr.app.getPath("userData")+"/");if(console.log(r,i,t),r!=="recording.ogg"||!t.startsWith(i))return null;try{let n=await(0,gr.readFile)(t);return new Uint8Array(n.buffer)}catch{return null}}var mt={};ee(mt,{sendToOverlay:()=>Bn});l();var wr=require("dgram"),yr;function Bn(e,t){t.messageType=t.type;let r=JSON.stringify(t);yr??=(0,wr.createSocket)("udp4"),yr.send(r,42069,"127.0.0.1")}var Tr={};l();var Sr=require("electron");l();var xr=`"use strict";const hiddenCSS=["#__ffYoutube1","#__ffYoutube2","#__ffYoutube3","#__ffYoutube4","#feed-pyv-container","#feedmodule-PRO","#homepage-chrome-side-promo","#merch-shelf","#offer-module",'#pla-shelf > ytd-pla-shelf-renderer[class="style-scope ytd-watch"]',"#pla-shelf","#premium-yva","#promo-info","#promo-list","#promotion-shelf","#related > ytd-watch-next-secondary-results-renderer > #items > ytd-compact-promoted-video-renderer.ytd-watch-next-secondary-results-renderer","#search-pva","#shelf-pyv-container","#video-masthead","#watch-branded-actions","#watch-buy-urls","#watch-channel-brand-div","#watch7-branded-banner","#YtKevlarVisibilityIdentifier","#YtSparklesVisibilityIdentifier",".carousel-offer-url-container",".companion-ad-container",".GoogleActiveViewElement",'.list-view[style="margin: 7px 0pt;"]',".promoted-sparkles-text-search-root-container",".promoted-videos",".searchView.list-view",".sparkles-light-cta",".watch-extra-info-column",".watch-extra-info-right",".ytd-carousel-ad-renderer",".ytd-compact-promoted-video-renderer",".ytd-companion-slot-renderer",".ytd-merch-shelf-renderer",".ytd-player-legacy-desktop-watch-ads-renderer",".ytd-promoted-sparkles-text-search-renderer",".ytd-promoted-video-renderer",".ytd-search-pyv-renderer",".ytd-video-masthead-ad-v3-renderer",".ytp-ad-action-interstitial-background-container",".ytp-ad-action-interstitial-slot",".ytp-ad-image-overlay",".ytp-ad-overlay-container",".ytp-ad-progress",".ytp-ad-progress-list",'[class*="ytd-display-ad-"]','[layout*="display-ad-"]','a[href^="http://www.youtube.com/cthru?"]','a[href^="https://www.youtube.com/cthru?"]',"ytd-action-companion-ad-renderer","ytd-banner-promo-renderer","ytd-compact-promoted-video-renderer","ytd-companion-slot-renderer","ytd-display-ad-renderer","ytd-promoted-sparkles-text-search-renderer","ytd-promoted-sparkles-web-renderer","ytd-search-pyv-renderer","ytd-single-option-survey-renderer","ytd-video-masthead-ad-advertiser-info-renderer","ytd-video-masthead-ad-v3-renderer","YTM-PROMOTED-VIDEO-RENDERER"],hideElements=()=>{const e=hiddenCSS;if(!e)return;const t=e.join(", ")+" { display: none!important; }",r=document.createElement("style");r.textContent=t,document.head.appendChild(r)},observeDomChanges=e=>{new MutationObserver(r=>{e(r)}).observe(document.documentElement,{childList:!0,subtree:!0})},hideDynamicAds=()=>{const e=document.querySelectorAll("#contents > ytd-rich-item-renderer ytd-display-ad-renderer");e.length!==0&&e.forEach(t=>{if(t.parentNode&&t.parentNode.parentNode){const r=t.parentNode.parentNode;r.localName==="ytd-rich-item-renderer"&&(r.style.display="none")}})},autoSkipAds=()=>{if(document.querySelector(".ad-showing")){const e=document.querySelector("video");e&&e.duration&&(e.currentTime=e.duration,setTimeout(()=>{const t=document.querySelector("button.ytp-ad-skip-button");t&&t.click()},100))}},overrideObject=(e,t,r)=>{if(!e)return!1;let n=!1;for(const o in e)e.hasOwnProperty(o)&&o===t?(e[o]=r,n=!0):e.hasOwnProperty(o)&&typeof e[o]=="object"&&overrideObject(e[o],t,r)&&(n=!0);return n},jsonOverride=(e,t)=>{const r=JSON.parse;JSON.parse=(...n)=>{const o=r.apply(this,n);return overrideObject(o,e,t),o},Response.prototype.json=new Proxy(Response.prototype.json,{async apply(...n){const o=await Reflect.apply(...n);return overrideObject(o,e,t),o}})};jsonOverride("adPlacements",[]),jsonOverride("playerAds",[]),hideElements(),hideDynamicAds(),autoSkipAds(),observeDomChanges(()=>{hideDynamicAds(),autoSkipAds()});
`;Sr.app.on("browser-window-created",(e,t)=>{t.webContents.on("frame-created",(r,{frame:i})=>{i?.once("dom-ready",()=>{C.store.plugins?.YoutubeAdblock?.enabled&&(i.url.includes("youtube.com/embed/")||i.url.includes("discordsays")&&i.url.includes("youtube.com"))&&i.executeJavaScript(xr)})})});var Er={AppleMusicRichPresence:nt,ConsoleShortcuts:it,FixSpotifyEmbeds:ar,FixYoutubeEmbeds:cr,MediaDownloader:ft,OpenInApp:ht,Translate:pt,VoiceMessages:dt,XSOverlay:mt,YoutubeAdblock:Tr};var br={};for(let[e,t]of Object.entries(Er)){let r=Object.entries(t);if(!r.length)continue;let i=br[e]={};for(let[n,s]of r){let o=`PlexcordPluginNative_${e}_${n}`;vt.ipcMain.handle(o,s),i[n]=o}}vt.ipcMain.on("PlexcordGetPluginIpcMethodMap",e=>{e.returnValue=br});l();Te();var S=require("electron");l();var Pr="PCFkb2N0eXBlIGh0bWw+PGh0bWwgbGFuZz0iZW4iPjxoZWFkPjxtZXRhIGNoYXJzZXQ9InV0Zi04Ij48dGl0bGU+UGxleGNvcmQgUXVpY2tDU1MgRWRpdG9yPC90aXRsZT48bGluayByZWw9InN0eWxlc2hlZXQiIGhyZWY9Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vbW9uYWNvLWVkaXRvckAwLjUwLjAvbWluL3ZzL2VkaXRvci9lZGl0b3IubWFpbi5jc3MiIGludGVncml0eT0ic2hhMjU2LXRpSlBRMk8wNHovcFovQXdkeUlnaHJPTXpld2YrUEl2RWwxWUtiUXZzWms9IiBjcm9zc29yaWdpbj0iYW5vbnltb3VzIiByZWZlcnJlcnBvbGljeT0ibm8tcmVmZXJyZXIiPjxzdHlsZT4jY29udGFpbmVyLGJvZHksaHRtbHtwb3NpdGlvbjphYnNvbHV0ZTtsZWZ0OjA7dG9wOjA7d2lkdGg6MTAwJTtoZWlnaHQ6MTAwJTttYXJnaW46MDtwYWRkaW5nOjA7b3ZlcmZsb3c6aGlkZGVufTwvc3R5bGU+PC9oZWFkPjxib2R5PjxkaXYgaWQ9ImNvbnRhaW5lciI+PC9kaXY+PHNjcmlwdCBzcmM9Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vbW9uYWNvLWVkaXRvckAwLjUwLjAvbWluL3ZzL2xvYWRlci5qcyIgaW50ZWdyaXR5PSJzaGEyNTYtS2NVNDhUR3I4NHI3dW5GN0o1SWdCbzk1YWVWckVickdlMDRTN1RjRlVqcz0iIGNyb3Nzb3JpZ2luPSJhbm9ueW1vdXMiIHJlZmVycmVycG9saWN5PSJuby1yZWZlcnJlciI+PC9zY3JpcHQ+PHNjcmlwdD5yZXF1aXJlLmNvbmZpZyh7cGF0aHM6e3ZzOiJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL21vbmFjby1lZGl0b3JAMC41MC4wL21pbi92cyJ9fSkscmVxdWlyZShbInZzL2VkaXRvci9lZGl0b3IubWFpbiJdLCgoKT0+e2dldEN1cnJlbnRDc3MoKS50aGVuKChlPT57dmFyIHQ9bW9uYWNvLmVkaXRvci5jcmVhdGUoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvbnRhaW5lciIpLHt2YWx1ZTplLGxhbmd1YWdlOiJjc3MiLHRoZW1lOmdldFRoZW1lKCl9KTt0Lm9uRGlkQ2hhbmdlTW9kZWxDb250ZW50KCgoKT0+c2V0Q3NzKHQuZ2V0VmFsdWUoKSkpKSx3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicmVzaXplIiwoKCk9Pnt0LmxheW91dCgpfSkpfSkpfSkpPC9zY3JpcHQ+PC9ib2R5PjwvaHRtbD4=";var Re=require("fs"),ge=require("fs/promises"),ve=require("path");l();var Vn=/[^\S\r\n]*?\r?(?:\r\n|\n)[^\S\r\n]*?\*[^\S\r\n]?/,Xn=/^\\@/;function gt(e,t={}){return{fileName:e,name:t.name??e.replace(/\.css$/i,""),author:t.author??"Unknown Author",description:t.description??"A Discord Theme.",version:t.version,license:t.license,source:t.source,website:t.website,invite:t.invite}}function Ir(e){return e.charCodeAt(0)===65279&&(e=e.slice(1)),e}function Dr(e,t){if(!e)return gt(t);let r=e.split("/**",2)?.[1]?.split("*/",1)?.[0];if(!r)return gt(t);let i={},n="",s="";for(let o of r.split(Vn))if(o.length!==0)if(o.charAt(0)==="@"&&o.charAt(1)!==" "){i[n]=s.trim();let a=o.indexOf(" ");n=o.substring(1,a),s=o.substring(a+1)}else s+=" "+o.replace("\\n",`
`).replace(Xn,"@");return i[n]=s.trim(),delete i[""],gt(t,i)}l();var Ar=require("electron");function Rr(e){e.webContents.setWindowOpenHandler(({url:t})=>{switch(t){case"about:blank":case"https://discord.com/popout":case"https://ptb.discord.com/popout":case"https://canary.discord.com/popout":return{action:"allow"}}try{var{protocol:r}=new URL(t)}catch{return{action:"deny"}}switch(r){case"http:":case"https:":case"mailto:":case"steam:":case"spotify:":Ar.shell.openExternal(t)}return{action:"deny"}})}(0,Re.mkdirSync)(te,{recursive:!0});function yt(e,t){let r=(0,ve.normalize)(e),i=(0,ve.join)(e,t),n=(0,ve.normalize)(i);return n.startsWith(r)?n:null}function Yn(){return(0,ge.readFile)(ze,"utf-8").catch(()=>"")}async function Jn(){let e=await(0,ge.readdir)(te).catch(()=>[]),t=[];for(let r of e){if(!r.endsWith(".css"))continue;let i=await _r(r).then(Ir).catch(()=>null);i!=null&&t.push(Dr(i,r))}return t}function _r(e){e=e.replace(/\?v=\d+$/,"");let t=yt(te,e);return t?(0,ge.readFile)(t,"utf-8"):Promise.reject(`Unsafe path ${e}`)}S.ipcMain.handle("PlexcordOpenQuickCss",()=>S.shell.openPath(ze));S.ipcMain.handle("PlexcordOpenExternal",(e,t)=>{try{var{protocol:r}=new URL(t)}catch{throw"Malformed URL"}if(!rr.includes(r))throw"Disallowed protocol.";S.shell.openExternal(t)});S.ipcMain.handle("PlexcordGetQuickCss",()=>Yn());S.ipcMain.handle("PlexcordSetQuickCss",(e,t)=>(0,Re.writeFileSync)(ze,t));S.ipcMain.handle("PlexcordGetThemesDir",()=>te);S.ipcMain.handle("PlexcordGetThemesList",()=>Jn());S.ipcMain.handle("PlexcordGetThemeData",(e,t)=>_r(t));S.ipcMain.handle("PlexcordGetThemeSystemValues",()=>({"os-accent-color":`#${S.systemPreferences.getAccentColor?.()||""}`}));S.ipcMain.handle("PlexcordOpenMonacoEditor",async()=>{let e="Plexcord QuickCSS Editor",t=S.BrowserWindow.getAllWindows().find(i=>i.title===e);if(t&&!t.isDestroyed()){t.focus();return}let r=new S.BrowserWindow({title:e,autoHideMenuBar:!0,darkTheme:!0,webPreferences:{preload:(0,ve.join)(__dirname,"plexcordDesktopPreload.js"),contextIsolation:!0,nodeIntegration:!1,sandbox:!1}});Rr(r),await r.loadURL(`data:text/html;base64,${Pr}`)});l();var Jr=require("electron");l();var Mr=require("module"),Kn=(0,Mr.createRequire)("/"),We,qn=";var __w=require('worker_threads');__w.parentPort.on('message',function(m){onmessage({data:m})}),postMessage=function(m,t){__w.parentPort.postMessage(m,t)},close=process.exit;self=global";try{We=Kn("worker_threads").Worker}catch{}var Qn=We?function(e,t,r,i,n){var s=!1,o=new We(e+qn,{eval:!0}).on("error",function(a){return n(a,null)}).on("message",function(a){return n(null,a)}).on("exit",function(a){a&&!s&&n(new Error("exited with code "+a),null)});return o.postMessage(r,i),o.terminate=function(){return s=!0,We.prototype.terminate.call(o)},o}:function(e,t,r,i,n){setImmediate(function(){return n(new Error("async operations unsupported - update to Node 12+ (or Node 10-11 with the --experimental-worker CLI flag)"),null)});var s=function(){};return{terminate:s,postMessage:s}},_=Uint8Array,oe=Uint16Array,Cr=Int32Array,St=new _([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Tt=new _([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),zr=new _([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Lr=function(e,t){for(var r=new oe(31),i=0;i<31;++i)r[i]=t+=1<<e[i-1];for(var n=new Cr(r[30]),i=1;i<30;++i)for(var s=r[i];s<r[i+1];++s)n[s]=s-r[i]<<5|i;return{b:r,r:n}},Gr=Lr(St,2),Et=Gr.b,ei=Gr.r;Et[28]=258,ei[258]=28;var Ur=Lr(Tt,0),Nr=Ur.b,Qo=Ur.r,$e=new oe(32768);for(v=0;v<32768;++v)V=(v&43690)>>1|(v&21845)<<1,V=(V&52428)>>2|(V&13107)<<2,V=(V&61680)>>4|(V&3855)<<4,$e[v]=((V&65280)>>8|(V&255)<<8)>>1;var V,v,ye=function(e,t,r){for(var i=e.length,n=0,s=new oe(t);n<i;++n)e[n]&&++s[e[n]-1];var o=new oe(t);for(n=1;n<t;++n)o[n]=o[n-1]+s[n-1]<<1;var a;if(r){a=new oe(1<<t);var c=15-t;for(n=0;n<i;++n)if(e[n])for(var h=n<<4|e[n],p=t-e[n],u=o[e[n]-1]++<<p,g=u|(1<<p)-1;u<=g;++u)a[$e[u]>>c]=h}else for(a=new oe(i),n=0;n<i;++n)e[n]&&(a[n]=$e[o[e[n]-1]++]>>15-e[n]);return a},_e=new _(288);for(v=0;v<144;++v)_e[v]=8;var v;for(v=144;v<256;++v)_e[v]=9;var v;for(v=256;v<280;++v)_e[v]=7;var v;for(v=280;v<288;++v)_e[v]=8;var v,Zr=new _(32);for(v=0;v<32;++v)Zr[v]=5;var v;var Wr=ye(_e,9,1);var jr=ye(Zr,5,1),je=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},z=function(e,t,r){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(t&7)&r},Fe=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(t&7)},Fr=function(e){return(e+7)/8|0},He=function(e,t,r){return(t==null||t<0)&&(t=0),(r==null||r>e.length)&&(r=e.length),new _(e.subarray(t,r))};var $r=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],R=function(e,t,r){var i=new Error(t||$r[e]);if(i.code=e,Error.captureStackTrace&&Error.captureStackTrace(i,R),!r)throw i;return i},Hr=function(e,t,r,i){var n=e.length,s=i?i.length:0;if(!n||t.f&&!t.l)return r||new _(0);var o=!r,a=o||t.i!=2,c=t.i;o&&(r=new _(n*3));var h=function(_t){var kt=r.length;if(_t>kt){var Ot=new _(Math.max(kt*2,_t));Ot.set(r),r=Ot}},p=t.f||0,u=t.p||0,g=t.b||0,L=t.l,F=t.d,Z=t.m,w=t.n,T=n*8;do{if(!L){p=z(e,u,1);var A=z(e,u+1,3);if(u+=3,A)if(A==1)L=Wr,F=jr,Z=9,w=5;else if(A==2){var O=z(e,u,31)+257,G=z(e,u+10,15)+4,Q=O+z(e,u+5,31)+1;u+=14;for(var M=new _(Q),ae=new _(19),b=0;b<G;++b)ae[zr[b]]=z(e,u+b*3,7);u+=G*3;for(var xe=je(ae),en=(1<<xe)-1,tn=ye(ae,xe,1),b=0;b<Q;){var Pt=tn[z(e,u,en)];u+=Pt&15;var E=Pt>>4;if(E<16)M[b++]=E;else{var le=0,ke=0;for(E==16?(ke=3+z(e,u,3),u+=2,le=M[b-1]):E==17?(ke=3+z(e,u,7),u+=3):E==18&&(ke=11+z(e,u,127),u+=7);ke--;)M[b++]=le}}var It=M.subarray(0,O),X=M.subarray(O);Z=je(It),w=je(X),L=ye(It,Z,1),F=ye(X,w,1)}else R(1);else{var E=Fr(u)+4,D=e[E-4]|e[E-3]<<8,k=E+D;if(k>n){c&&R(0);break}a&&h(g+D),r.set(e.subarray(E,k),g),t.b=g+=D,t.p=u=k*8,t.f=p;continue}if(u>T){c&&R(0);break}}a&&h(g+131072);for(var rn=(1<<Z)-1,nn=(1<<w)-1,Be=u;;Be=u){var le=L[Fe(e,u)&rn],ce=le>>4;if(u+=le&15,u>T){c&&R(0);break}if(le||R(2),ce<256)r[g++]=ce;else if(ce==256){Be=u,L=null;break}else{var Dt=ce-254;if(ce>264){var b=ce-257,Se=St[b];Dt=z(e,u,(1<<Se)-1)+Et[b],u+=Se}var Ve=F[Fe(e,u)&nn],Xe=Ve>>4;Ve||R(3),u+=Ve&15;var X=Nr[Xe];if(Xe>3){var Se=Tt[Xe];X+=Fe(e,u)&(1<<Se)-1,u+=Se}if(u>T){c&&R(0);break}a&&h(g+131072);var At=g+Dt;if(g<X){var Rt=s-X,on=Math.min(X,At);for(Rt+g<0&&R(3);g<on;++g)r[g]=i[Rt+g]}for(;g<At;++g)r[g]=r[g-X]}}t.l=L,t.p=Be,t.b=g,t.f=p,L&&(p=1,t.m=Z,t.d=F,t.n=w)}while(!p);return g!=r.length&&o?He(r,0,g):r.subarray(0,g)};var ti=new _(0);var ri=function(e,t){var r={};for(var i in e)r[i]=e[i];for(var i in t)r[i]=t[i];return r},kr=function(e,t,r){for(var i=e(),n=e.toString(),s=n.slice(n.indexOf("[")+1,n.lastIndexOf("]")).replace(/\s+/g,"").split(","),o=0;o<i.length;++o){var a=i[o],c=s[o];if(typeof a=="function"){t+=";"+c+"=";var h=a.toString();if(a.prototype)if(h.indexOf("[native code]")!=-1){var p=h.indexOf(" ",8)+1;t+=h.slice(p,h.indexOf("(",p))}else{t+=h;for(var u in a.prototype)t+=";"+c+".prototype."+u+"="+a.prototype[u].toString()}else t+=h}else r[c]=a}return t},Ze=[],ni=function(e){var t=[];for(var r in e)e[r].buffer&&t.push((e[r]=new e[r].constructor(e[r])).buffer);return t},ii=function(e,t,r,i){if(!Ze[r]){for(var n="",s={},o=e.length-1,a=0;a<o;++a)n=kr(e[a],n,s);Ze[r]={c:kr(e[o],n,s),e:s}}var c=ri({},Ze[r].e);return Qn(Ze[r].c+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",r,c,ni(c),i)},oi=function(){return[_,oe,Cr,St,Tt,zr,Et,Nr,Wr,jr,$e,$r,ye,je,z,Fe,Fr,He,R,Hr,bt,Br,Vr]};var Br=function(e){return postMessage(e,[e.buffer])},Vr=function(e){return e&&{out:e.size&&new _(e.size),dictionary:e.dictionary}},si=function(e,t,r,i,n,s){var o=ii(r,i,n,function(a,c){o.terminate(),s(a,c)});return o.postMessage([e,t],t.consume?[e.buffer]:[]),function(){o.terminate()}};var W=function(e,t){return e[t]|e[t+1]<<8},N=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},wt=function(e,t){return N(e,t)+N(e,t+4)*4294967296};function ai(e,t,r){return r||(r=t,t={}),typeof r!="function"&&R(7),si(e,t,[oi],function(i){return Br(bt(i.data[0],Vr(i.data[1])))},1,r)}function bt(e,t){return Hr(e,{i:2},t&&t.out,t&&t.dictionary)}var xt=typeof TextDecoder<"u"&&new TextDecoder,li=0;try{xt.decode(ti,{stream:!0}),li=1}catch{}var ci=function(e){for(var t="",r=0;;){var i=e[r++],n=(i>127)+(i>223)+(i>239);if(r+n>e.length)return{s:t,r:He(e,r-1)};n?n==3?(i=((i&15)<<18|(e[r++]&63)<<12|(e[r++]&63)<<6|e[r++]&63)-65536,t+=String.fromCharCode(55296|i>>10,56320|i&1023)):n&1?t+=String.fromCharCode((i&31)<<6|e[r++]&63):t+=String.fromCharCode((i&15)<<12|(e[r++]&63)<<6|e[r++]&63):t+=String.fromCharCode(i)}};function ui(e,t){if(t){for(var r="",i=0;i<e.length;i+=16384)r+=String.fromCharCode.apply(null,e.subarray(i,i+16384));return r}else{if(xt)return xt.decode(e);var n=ci(e),s=n.s,r=n.r;return r.length&&R(8),s}}var fi=function(e,t){return t+30+W(e,t+26)+W(e,t+28)},hi=function(e,t,r){var i=W(e,t+28),n=ui(e.subarray(t+46,t+46+i),!(W(e,t+8)&2048)),s=t+46+i,o=N(e,t+20),a=r&&o==4294967295?pi(e,s):[o,N(e,t+24),N(e,t+42)],c=a[0],h=a[1],p=a[2];return[W(e,t+10),c,h,n,s+W(e,t+30)+W(e,t+32),p]},pi=function(e,t){for(;W(e,t)!=1;t+=4+W(e,t+2));return[wt(e,t+12),wt(e,t+4),wt(e,t+20)]};var Or=typeof queueMicrotask=="function"?queueMicrotask:typeof setTimeout=="function"?setTimeout:function(e){e()};function Xr(e,t,r){r||(r=t,t={}),typeof r!="function"&&R(7);var i=[],n=function(){for(var w=0;w<i.length;++w)i[w]()},s={},o=function(w,T){Or(function(){r(w,T)})};Or(function(){o=r});for(var a=e.length-22;N(e,a)!=101010256;--a)if(!a||e.length-a>65558)return o(R(13,0,1),null),n;var c=W(e,a+8);if(c){var h=c,p=N(e,a+16),u=p==4294967295||h==65535;if(u){var g=N(e,a-12);u=N(e,g)==101075792,u&&(h=c=N(e,g+32),p=N(e,g+48))}for(var L=t&&t.filter,F=function(w){var T=hi(e,p,u),A=T[0],E=T[1],D=T[2],k=T[3],O=T[4],G=T[5],Q=fi(e,G);p=O;var M=function(b,xe){b?(n(),o(b,null)):(xe&&(s[k]=xe),--c||o(null,s))};if(!L||L({name:k,size:E,originalSize:D,compression:A}))if(!A)M(null,He(e,Q,Q+E));else if(A==8){var ae=e.subarray(Q,Q+E);if(D<524288||E>.8*D)try{M(null,bt(ae,{out:new _(D)}))}catch(b){M(b,null)}else i.push(ai(ae,{size:D},M))}else M(R(14,"unknown compression type "+A,1),null);else M(null,null)},Z=0;Z<h;++Z)F(Z)}else o(null,{});return n}var Kr=require("fs"),j=require("fs/promises"),we=require("path");l();function Yr(e){function t(o,a,c,h){let p=0;return p+=o<<0,p+=a<<8,p+=c<<16,p+=h<<24>>>0,p}if(e[0]===80&&e[1]===75&&e[2]===3&&e[3]===4)return e;if(e[0]!==67||e[1]!==114||e[2]!==50||e[3]!==52)throw new Error("Invalid header: Does not start with Cr24");let r=e[4]===3,i=e[4]===2;if(!i&&!r||e[5]||e[6]||e[7])throw new Error("Unexpected crx format version number.");if(i){let o=t(e[8],e[9],e[10],e[11]),a=t(e[12],e[13],e[14],e[15]),c=16+o+a;return e.subarray(c,e.length)}let s=12+t(e[8],e[9],e[10],e[11]);return e.subarray(s,e.length)}Ye();var di=(0,we.join)(Ce,"ExtensionCache");async function mi(e,t){return await(0,j.mkdir)(t,{recursive:!0}),new Promise((r,i)=>{Xr(e,(n,s)=>{if(n)return void i(n);Promise.all(Object.keys(s).map(async o=>{if(o.startsWith("_metadata/"))return;if(o.endsWith("/"))return void(0,j.mkdir)((0,we.join)(t,o),{recursive:!0});let a=o.split("/"),c=a.pop(),h=a.join("/"),p=(0,we.join)(t,h);h&&await(0,j.mkdir)(p,{recursive:!0}),await(0,j.writeFile)((0,we.join)(p,c),s[o])})).then(()=>r()).catch(o=>{(0,j.rm)(t,{recursive:!0,force:!0}),i(o)})})})}async function qr(e){let t=(0,we.join)(di,`${e}`);try{await(0,j.access)(t,Kr.constants.F_OK)}catch{let i=e==="fmkadmapgofadopljbjfkapdkoienihi"?"https://raw.githubusercontent.com/MutanPlex/random-files/5159afb6d3d9dfae4f0669399f0756580ffa371d/fmkadmapgofadopljbjfkapdkoienihi.zip":`https://clients2.google.com/service/update2/crx?response=redirect&acceptformat=crx2,crx3&x=id%3D${e}%26uc&prodversion=${process.versions.chrome}`,n=await ue(i,{headers:{"User-Agent":`Electron ${process.versions.electron} ~ Plexcord (https://github.com/MutanPlex/Plexcord)`}});await mi(Yr(n),t).catch(console.error)}Jr.session.defaultSession.loadExtension(t)}se.app.whenReady().then(()=>{se.protocol.registerFileProtocol("plexcord",({url:n},s)=>{let o=n.slice(11);if(o.endsWith("/")&&(o=o.slice(0,-1)),o.startsWith("/themes/")){let a=o.slice(8),c=yt(te,a);if(!c){s({statusCode:403});return}s(c.replace(/\?v=\d+$/,""));return}switch(o){case"renderer.js.map":case"plexcordDesktopRenderer.js.map":case"preload.js.map":case"plexcordDesktopPreload.js.map":case"patcher.js.map":case"plexcordDesktopMain.js.map":s((0,Qr.join)(__dirname,o));break;default:s({statusCode:403})}});try{C.store.enableReactDevtools&&qr("fmkadmapgofadopljbjfkapdkoienihi").then(()=>console.info("[Plexcord] Installed React Developer Tools")).catch(n=>console.error("[Plexcord] Failed to install React Developer Tools",n))}catch{}let e=(n,s)=>Object.keys(n).find(o=>o.toLowerCase()===s),t=n=>{let s={};return n.split(";").forEach(o=>{let[a,...c]=o.trim().split(/\s+/g);a&&!Object.prototype.hasOwnProperty.call(s,a)&&(s[a]=c)}),s},r=n=>Object.entries(n).filter(([,s])=>s?.length).map(s=>s.flat().join(" ")).join("; "),i=n=>{let s=e(n,"content-security-policy");if(s){let o=t(n[s][0]);for(let a of["style-src","connect-src","img-src","font-src","media-src","worker-src"])o[a]??=[],o[a].push("*","blob:","data:","plexcord:","'unsafe-inline'");o["script-src"]??=[],o["script-src"].push("'unsafe-eval'","https://cdn.jsdelivr.net","https://cdnjs.cloudflare.com"),n[s]=[r(o)]}};se.session.defaultSession.webRequest.onHeadersReceived(({responseHeaders:n,resourceType:s},o)=>{if(n&&(s==="mainFrame"&&i(n),s==="stylesheet")){let a=e(n,"content-type");a&&(n[a]=["text/css"])}o({cancel:!1,responseHeaders:n})}),se.session.defaultSession.webRequest.onHeadersReceived=()=>{}});
//# sourceURL=PlexcordDesktopMain
//# sourceMappingURL=plexcord://plexcordDesktopMain.js.map
/*! For license information please see plexcordDesktopMain.js.LEGAL.txt */
